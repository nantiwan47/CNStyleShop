{% extends "base.html" %}

{% block content %}
<div class="max-w-5xl mx-auto bg-white shadow-lg rounded-lg p-6">
    <h1 class="text-2xl font-bold text-gray-800 mb-4">üõí ‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</h1>

    {% if items %}
    <table class="w-full border-collapse border border-gray-200">
        <thead>
            <tr class="bg-gray-100">
                <th class="p-3 border">‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</th>
                <th class="p-3 border">‡∏£‡∏≤‡∏Ñ‡∏≤</th>
                <th class="p-3 border">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô</th>
                <th class="p-3 border">‡∏£‡∏ß‡∏°</th>
                <th class="p-3 border">‡∏•‡∏ö</th>
            </tr>
        </thead>
        <tbody>
            {% for item in items %}
            <tr class="text-center">
                <td class="p-3 border flex items-center space-x-3">
                    <img src="{{ item.product.cover_image.url  }}" alt="{{ item.product.name }}"
                         class="w-16 h-16 object-cover rounded">
                    <div class="text-left">
                        <p class="font-semibold">{{ item.product.name }}</p>
                        <p class="text-gray-500">{{ item.product_option.color }} / {{ item.product_option.size }}</p>
                    </div>
                </td>
                <td class="p-3 border text-red-500">‡∏ø{{ item.product_option.price }}</td>
               <td class="p-3 border">
                    <div class="flex items-center justify-center">
                        <!-- ‡∏õ‡∏∏‡πà‡∏°‡∏•‡∏î‡∏à‡∏≥‡∏ô‡∏ß‡∏ô -->
                        <button type="button" onclick="updateQuantity({{ item.id }}, 'decrease', this)"
                                class="px-2 py-1 border rounded bg-gray-200 text-gray-700">‚àí</button>

                        <!-- ‡∏ä‡πà‡∏≠‡∏á‡πÅ‡∏™‡∏î‡∏á‡∏à‡∏≥‡∏ô‡∏ß‡∏ô -->
                        <span id="quantity-{{ item.id }}" class="mx-2">{{ item.quantity }}</span>

                        <!-- ‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏à‡∏≥‡∏ô‡∏ß‡∏ô -->
                        <button type="button" onclick="updateQuantity({{ item.id }}, 'increase', this)"
                                class="px-2 py-1 border rounded bg-gray-200 text-gray-700">+</button>
                    </div>
                </td>


                <td class="p-3 border text-green-600 total-price" id="item-total-{{ item.id }}">
                    ‡∏ø{{ item.item_price }}
                </td>

                <td class="p-3 border">
                    <a href="{% url 'remove_cart_item' item.id %}"
                       class="text-red-500 hover:underline">‚ùå</a>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <!-- ‡∏õ‡∏∏‡πà‡∏° Checkout -->
    <div class="flex justify-end mt-6">
        <p class="text-xl font-semibold mr-4">üí∞ ‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°: <span id="cart-total">‡∏ø{{ cart.get_total_price }}</span></p>
        <a href="{% url 'checkout' %}"
           class="bg-red-500 text-white px-6 py-3 rounded-lg text-lg hover:bg-red-600">
            üè∑Ô∏è ‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠
        </a>
    </div>

    {% else %}
    <p class="text-center text-gray-600">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏ô‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤ üõçÔ∏è</p>
    {% endif %}
</div>

<script>
    function updateQuantity(itemId, action, button) {
        fetch(`/cart/update/${itemId}/`, {
            method: "POST",
            headers: {
                "Content-Type": "application/x-www-form-urlencoded",
                "X-CSRFToken": "{{ csrf_token }}"
            },
            body: `action=${action}`
        })
        .then(response => response.json())
        .then(data => {
        if (data.quantity !== undefined) {
            // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤
            document.getElementById(`quantity-${itemId}`).textContent = data.quantity;
            // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏£‡∏≤‡∏Ñ‡∏≤‡∏£‡∏ß‡∏°‡∏Ç‡∏≠‡∏á‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ô‡∏±‡πâ‡∏ô
            document.getElementById(`item-total-${itemId}`).textContent = `‡∏ø${data.item_total}`;
            // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏£‡∏≤‡∏Ñ‡∏≤‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏Ç‡∏≠‡∏á‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤
            document.getElementById("cart-total").textContent = `‡∏ø${data.cart_total}`;
        }
    })
        .catch(error => console.error("Error:", error));
    }
</script>


{% endblock %}
