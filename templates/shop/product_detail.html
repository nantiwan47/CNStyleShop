{% extends 'base.html' %}

{% block content %}
    <!-- แสดง messages success-->
    {% include "components/alert/alert_message.html" with messages=messages %}

<div class="container mx-auto bg-white min-h-screen rounded-lg">

    <div class="flex flex-col md:flex-row gap-6 p-10">
        <!-- รูปภาพสินค้า -->
        <div class="w-full md:w-1/2 flex">
            <!-- thumbnail Gallery รูปภาพเพิ่มเติม -->
            <div class="flex flex-col justify-center gap-2 mr-4 h-[400px]">
                  <img src="{{ product.cover_image.url }}" class="thumbnail w-16 h-16 object-cover rounded border-2 border-gray-300 hover:border-red-500 cursor-pointer border-red-500"
                    onclick="document.getElementById('main-image').src='{{ product.cover_image.url }}'; selectThumbnail(this)">

                {% for image in images %}
                <img src="{{ image.image.url }}" class="thumbnail w-16 h-16 object-cover rounded border-2 border-gray-300 hover:border-red-500 cursor-pointer"
                    onclick="document.getElementById('main-image').src='{{ image.image.url }}'; selectThumbnail(this)">
                {% endfor %}
            </div>

            <!-- รูปภาพสินค้า -->
            <div class="flex-1 border border-gray-300 rounded overflow-hidden flex justify-center items-center h-[400px]">
                <img id="main-image" src="{{ product.cover_image.url }}" class="max-w-full max-h-full object-contain transition-transform duration-300">
            </div>
        </div>


        <!-- รายละเอียดสินค้า -->
        <div class="w-full md:w-1/2 md:ml-6">
            <h1 class="text-2xl font-bold">{{ product.name }}</h1>
            <p class="text-gray-600 text-sm mt-2">{{ product.description }}</p>

            <!-- ตัวเลือกสินค้า และปุ่ม -->
            <div id="product-options" class="mt-4">
                {% include "shop/partials/product_options.html" with product_id=product.id all_colors=colors all_sizes=sizes available_colors=colors available_sizes=sizes selected_color='' selected_size='' price=price product_option_id=None %}
            </div>

            <!-- จำนวนสินค้า -->
            <div class="flex items-center space-x-2 mt-4">
                <button type="button" id="decrease" class="bg-gray-300 text-gray-700 px-3 py-1 rounded">−</button>
                <label for="quantity" class="sr-only">จำนวน</label>
                <input type="number" id="quantity" name="quantity" value="1" min="1"
                       class="border text-center w-16 py-1 rounded" readonly>
                <button type="button" id="increase" class="bg-gray-300 text-gray-700 px-3 py-1 rounded">+</button>
            </div>

            <!-- ปุ่มกดเพิ่มรถเข็น/ซื้อสินค้า -->
            <div class="flex space-x-4 mt-4">
                <!-- เพิ่มลงรถเข็น -->
                <form action="{% url 'add_cart' product.id %}" method="post" id="cart-form">
                    {% csrf_token %}
                    <input type="hidden" name="option_id" id="cart-option-id">
                    <input type="hidden" name="quantity" id="cart-quantity" value="1">

                    <button type="submit" class="bg-blue-500 text-white px-4 py-2 rounded disabled:bg-gray-400 disabled:cursor-not-allowed" id="add-to-cart" disabled>
                        เพิ่มลงรถเข็น
                    </button>
                </form>

                <!-- ซื้อสินค้า -->
                <form action="{% url 'buy_now' %}" method="get" id="buy-now-form">
                    <input type="hidden" name="product_id" value="{{ product.id }}">
                    <input type="hidden" name="option_id" id="buy-option-id">
                    <input type="hidden" name="quantity" id="buy-quantity" value="1">

                    <button type="submit" class="bg-green-500 text-white px-4 py-2 rounded disabled:bg-gray-400 disabled:cursor-not-allowed" id="buy-now" disabled>
                        ซื้อสินค้า
                    </button>
                </form>
            </div>
        </div>
    </div>
</div>

<script>
    function selectThumbnail(selectedThumbnail) {
        // ลบกรอบจากทุก thumbnail
        let thumbnails = document.querySelectorAll('.thumbnail');
        thumbnails.forEach(thumb => thumb.classList.remove('border-red-500'));

        // เพิ่มกรอบสีแดงให้กับ thumbnail ที่ถูกเลือก
        selectedThumbnail.classList.add('border-red-500');
    }

    // เมื่อโหลดหน้าเว็บเสร็จ (DOMContentLoaded) ให้เริ่มทำงาน
    document.addEventListener("DOMContentLoaded", function () {
        // ดึงองค์ประกอบที่เกี่ยวข้องกับจำนวนสินค้า
        const quantityInput = document.getElementById("quantity");
        const cartQuantityInput = document.getElementById("cart-quantity");
        const buyQuantityInput = document.getElementById("buy-quantity");
        const decreaseBtn = document.getElementById("decrease");
        const increaseBtn = document.getElementById("increase");

        // ฟังก์ชันอัปเดตจำนวนสินค้าให้เป็นค่าที่กำหนด
        function updateQuantity(value) {
            quantityInput.value = value;
            cartQuantityInput.value = value;
            buyQuantityInput.value = value;
        }

        // กดปุ่มลดจำนวนสินค้า
        decreaseBtn.addEventListener("click", function () {
            let currentValue = parseInt(quantityInput.value, 10);
            if (currentValue > 1) {
                updateQuantity(currentValue - 1);
            }
        });

        // กดปุ่มเพิ่มจำนวนสินค้า
        increaseBtn.addEventListener("click", function () {
            // แปลงค่าจาก string เป็น number (integer) โดยใช้เลขฐาน 10
            let currentValue = parseInt(quantityInput.value, 10);
            updateQuantity(currentValue + 1);
        });
    });
</script>

{% endblock %}
